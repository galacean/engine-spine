@ali/ci
---------------

è‡ªåŠ¨ç”Ÿæˆ gitlab-ci, aone æˆ–è€… cise çš„é…ç½®æ–‡ä»¶ã€‚

## Badges

[![Build status][build-status-image]][aone-ci-url]
[![Line coverage][line-coverage-image]][aone-ci-url]
[![Branch coverage][branch-coverage-image]][aone-ci-url]
![node >=4.0.0](https://duing.alibaba-inc.com/img/label?key=node&value=%3E%3D4.0.0&keyBgColor=505050&valueBgColor=51CA2A&size=12)
[![TNPM version][tnpm-image]][tnpm-url]
[![TNPM downloads][tnpm-downloads-image]][tnpm-url]

[tnpm-image]: https://npm.alibaba-inc.com/badge/v/@ali/ci.svg
[tnpm-url]: https://npm.alibaba-inc.com/package/@ali/ci
[tnpm-downloads-image]: https://npm.alibaba-inc.com/badge/d/@ali/ci.svg
[aone-ci-url]: https://aone-api.alibaba-inc.com/ak/testservice/api/badge/link?repo=git@gitlab.alibaba-inc.com:node/ci.git
[build-status-image]: https://aone-api.alibaba-inc.com/ak/testservice/api/badge/query?repo=git@gitlab.alibaba-inc.com:node/ci.git&type=%E6%9E%84%E5%BB%BA%E7%8A%B6%E6%80%81
[line-coverage-image]: https://aone-api.alibaba-inc.com/ak/testservice/api/badge/query?repo=git@gitlab.alibaba-inc.com:node/ci.git&type=%E5%8D%95%E6%B5%8B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87
[branch-coverage-image]: https://aone-api.alibaba-inc.com/ak/testservice/api/badge/query?repo=git@gitlab.alibaba-inc.com:node/ci.git&type=%E5%8D%95%E6%B5%8B%E5%88%86%E6%94%AF%E8%A6%86%E7%9B%96%E7%8E%87

--------------------

## Installation

```bash
$ tnpm install @ali/ci --save-dev
```

## Usage

åœ¨ `package.json` ä¸­é€šè¿‡é…ç½® `ci` å­—æ®µæ¥å®šåˆ¶ç”Ÿæˆçš„é…ç½®ï¼š

```js
"ci": {
  "type": "", // é»˜è®¤æ˜¯ aoneci æ¥ç”Ÿæˆ Aone CI yml é…ç½®ï¼Œè¯·è®°å¾—åœ¨ gitlab é…ç½®é‡Œé¢å¼€å¯ CISEã€‚
  // gitlab ä»£è¡¨ä½¿ç”¨ gitlab-ci è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰é…ç½® type å¹¶ä¸” gitlab æ˜¯èš‚èšçš„ï¼Œä¼šé»˜è®¤è®¾ç½®ä¸º gitlab
  // aone æ˜¯è€çš„æ ¼å¼ï¼Œå»ºè®®ä½¿ç”¨ aoneciï¼Œæ ¹æ®ç®€å•ï¼Œç”± @ç„¦éœ¸ ä¸“ä¸šæ”¯æŒï¼
  // aci èš‚èšæœ€æ–°çš„ ci ç¯å¢ƒï¼Œå®˜æ–¹æ¨èï¼Œå‘ç°ä»£ç åº“åœ¨ code.linke.alipay.com ä¹Ÿä¼šè‡ªåŠ¨è®¾ç½®ä¸º aci
  "version": "8", // æµ‹è¯•çš„ node ç‰ˆæœ¬ï¼Œé»˜è®¤åªæµ‹è¯•æœ€æ–°ç¨³å®šç‰ˆï¼ˆç°åœ¨æ˜¯ 8.x)ï¼Œå¯ä»¥é€šè¿‡ "8, 10, 12" æŒ‡å®šå¤šä¸ªç‰ˆæœ¬
  // è¿˜å¯ä»¥æŒ‡å®šä½¿ç”¨ alinode è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ `alinode=4`, `alinode=5.0.0` https://help.aliyun.com/knowledge_detail/60811.html
  // æ˜¯å¦é€šè¿‡ docker æ¥è¿è¡Œï¼Œåªåœ¨ gitlab çš„ ci ä¸­æ”¯æŒï¼Œé»˜è®¤ä¸º trueã€‚å¦‚æœä½ çš„ ci runner æ˜¯è‡ªå·±æ­å»ºçš„ï¼Œè¯·è®¾ç½®ä¸º falseã€‚
  "docker": true,
  "tags": "" // gitlab-ci çš„ tags é…ç½®
  "fntest": false, // æ˜¯å¦æ‰§è¡ŒåŠŸèƒ½æµ‹è¯•ï¼Œåªåœ¨å¯ç”¨ docker çš„ ci ä¸­æ”¯æŒï¼Œé»˜è®¤ä¸º false
  "tengine": true, // æ˜¯å¦å®‰è£… tengineï¼Œ åªåœ¨ aci ä¸­æ”¯æŒï¼Œé»˜è®¤ä¸º false
  "command": "ci" // è·‘ ci æµ‹è¯•æ—¶æ‰§è¡Œå“ªä¸ª npm scriptï¼Œé»˜è®¤ä¸º `ci`ï¼Œå³ä¼šæ‰§è¡Œ `npm run ci`,
  "cpp": false, // æ˜¯å¦éœ€è¦ cpp æ¨¡å—ç¼–è¯‘ç¯å¢ƒï¼Œé»˜è®¤ä¸º falseï¼Œç›®å‰åªé€‚ç”¨äº aoneci
  "autoBadges": true, // æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ aone ci å’Œ tnpm badgesï¼Œé»˜è®¤ä¸º true
  "coverage": true, // æ˜¯å¦æ”¯æŒæ”¶é›† coverage ä¿¡æ¯ï¼Œè®¾ç½®ä¸º false ä¹‹å aci æ¨¡å¼ä¸ä¼šæ”¶é›† coverage ä¿¡æ¯
  "image": "", // é…ç½®é•œåƒï¼Œé»˜è®¤ä¸º node-ci
  "resource": {
    "cpu": 4,
    "memory": 12,
    "storage": 30
  } // ACI æ‰§è¡Œèµ„æºé…ç½®ï¼Œé»˜è®¤ 4c12g30g é…ç½®
}
```

## åŸç†

å®‰è£…æ­¤æ¨¡å—æ—¶ä¼šé€šè¿‡ `npm postinstall hook` æ¥æ›´æ–°æœ¬åœ°çš„ yml æ–‡ä»¶ï¼Œå¦‚æœéœ€è¦æ›´æ–°æ–‡ä»¶ï¼Œè¯·é‡æ–°å®‰è£…æ”¹æ¨¡å—å³å¯ã€‚

## æ”¯æŒ AoneCI éœ€è¦çš„ TEST_CASE_AMOUNT è¾“å‡º

- egg-bin é»˜è®¤ä¼šè¾“å‡º mochawesome-reports ï¼Œalicov ä¼šè‡ªåŠ¨è¯»å–æŠ¥å‘Šæ•°æ®ç”Ÿæˆ aoneci éœ€è¦çš„ TEST_CASE_AMOUNT è¾“å‡ºã€‚
- jestï¼Œå†…ç½®çš„ json æŠ¥å‘Šè¾“å‡ºç¬¦åˆ alicov é˜…è¯»çš„ç»Ÿè®¡æ•°æ®ã€‚
```bash
"cov": "jest --json > node_modules/.tap.json"
```
- mochaï¼Œå¯ä»¥ä½¿ç”¨ [tab-json](https://github.com/gummesson/tap-json) æŠ¥å‘Šï¼Œè¾“å‡ºç¬¦åˆ alicov é˜…è¯»çš„ç»Ÿè®¡æ•°æ®ã€‚
```bash
"cov": "mocha --tap | tap-json > node_modules/.tap.json"
```
- avaï¼Œå¯ä»¥ä½¿ç”¨ [ava-tap-json](https://github.com/yovasx2/ava-tap-json) æŠ¥å‘Šï¼Œè¾“å‡ºç¬¦åˆ alicov é˜…è¯»çš„ç»Ÿè®¡æ•°æ®ã€‚
```bash
"cov": "NODE_ENV=test nyc ava --tap | ava-tap-json > node_modules/.tap.json && nyc report --reporter=json --reporter=lcov"
```
- å…¶ä»–æµ‹è¯•æ¡†æ¶ï¼Œç”Ÿæˆ tap json æŠ¥å‘Šåˆ° `node_modules/.tap.json` ç›®å½•å³å¯ã€‚

![](http://alipay-rmsdeploy-dev-assets.oss-cn-hangzhou-zmf.aliyuncs.com/tfs-upload/ali-43624.local/1594005912243-LDm5zQmWnhknb3PV-pngpaste_1594005911536.png)

## å‚è€ƒæ–‡ç« 

- [Aone å¾½ç« å¤§å…¨](https://www.atatech.org/articles/67130)
- [é˜¿é‡Œé›†å›¢ GitLab æé€Ÿæ¥å…¥ Aone CI](https://yuque.antfin-inc.com/suqian.yf/123/gitlab-plus-aoneci)
- [DUING å†…ç½‘ Badge æœåŠ¡](https://yuque.antfin-inc.com/lisheng.lisheng/mx9fm5/ta3dan)

## Contributors(16)

Ordered by date of first contribution, by [ali-contributors](https://gitlab.alibaba-inc.com/node/ali-contributors).

- <a target="_blank" href="https://work.alibaba-inc.com/work/u/52624"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/52624.40x40.xz.jpg"> @ä¸å››</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=deadhorse"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> ä¸å››ğŸ´</a>
- <a target="_blank" href="https://fengmk2.com"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/43624.40x40.xz.jpg"> @è‹åƒ</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=fengmk2"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> è‹åƒ</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/70032"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/70032.40x40.xz.jpg"> @å®«ç…Œ</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=gf8f2zh"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> å®«ç…Œ Zhang Yuheng</a>
- <a target="_blank" href="http://chuo.me"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/28761.40x40.xz.jpg"> @è´¯é«˜</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=popomore"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> è´¯é«˜</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/89488"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/89488.40x40.xz.jpg"> @å¤©ç­‘</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=atian25"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> å¤©çŒª(å¤©ç­‘)</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/55162"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/55162.40x40.xz.jpg"> @åå³</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=afc163"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> ç§’</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/87330"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/87330.40x40.xz.jpg"> @å¤œæ²‰</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=ta6lb4d"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> å¤œæ²‰</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/33772"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/33772.40x40.xz.jpg"> @æ±¤å°§</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=slauxsy"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> æ±¤å°§</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/70088"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/70088.40x40.xz.jpg"> @å•¸ç”Ÿ</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=ikobe621"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> å•¸ç”Ÿ</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/123061"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/123061.40x40.xz.jpg"> @è¡€è¾°</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=hongxingshi"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> è¡€è¾°</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/157028"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/157028.40x40.xz.jpg"> @é›¶å¼Œ</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=mx53epm"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> é›¶å¼Œ(yÄ«)</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/79696"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/79696.40x40.xz.jpg"> @æ…•é™¶</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=etlx8r9"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> æ…•é™¶</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/80222"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/80222.40x40.xz.jpg"> @è›‹æ€»</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=hacke2"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> è›‹æ€»</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/208698"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/208698.40x40.xz.jpg"> @å…­ç‰™</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=yaphetszmn"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> å…­ç‰™</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/72970"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/72970.40x40.xz.jpg"> @è°·ç«¥</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=valleykid"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> vk(è°·ç«¥)</a>
- <a target="_blank" href="https://work.alibaba-inc.com/work/u/76397"><img style="vertical-align: middle;" width="20" src="https://work.alibaba-inc.com/photo/76397.40x40.xz.jpg"> @ç¥¤è½©</a> <a target="_blank" href="dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=xiazhenhua"><img style="vertical-align: middle;" width="20" src="https://img.alicdn.com/tfs/TB18HtyiyqAXuNjy1XdXXaYcVXa-24-24.svg"> ç¥¤è½©</a>

---
[![CoffeePay æ‰“èµ](http://coffee.alibaba-inc.com/projects/585d6ebe5fb92e2c19c00a00/badge)](http://coffee.alibaba-inc.com/donates?id=585d6ebe5fb92e2c19c00a00)
æ¬¢è¿æ‰“èµä¸€æ¯å’–å•¡~
<br>
<img width="150" src="http://coffee.alibaba-inc.com/projects/585d6ebe5fb92e2c19c00a00/qr">


--------------------
